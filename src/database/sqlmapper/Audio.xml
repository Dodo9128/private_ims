<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.fdreplay.ims.audio.Audio">
	<select id="getMaxAudioId" parameterType="Map" resultType="Integer">
		SELECT CAST( IFNULL( MAX( RIGHT( id, 3 ) ), '000' ) AS UNSIGNED INTEGER ) + 1 FROM audio WHERE id LIKE #{system_id}
	</select>
    <!--=======================================
    	목록 조회
     =======================================-->
	<sql id="listAudioFromWhere">
		FROM 	audio A
		WHERE	1=1
		<if	test='id !=null and id !=""'>
			AND A.id = #{id}
		</if>
	</sql>
	
	<select id="listAudioCount" parameterType="Map" resultType="Integer">
		<include refid="CommonSQL.selectCount" />
		<include refid="listAudioFromWhere" />
    </select>

    <select id="listAudio" resultType="Map">
		<include refid="CommonSQL.pagingPreFix" />
		SELECT 	
			A.id
			, A.group_id
			, A.codec
			, A.channel_type
			, A.sample_rate
			, A.sample_bit
			, A.is_input
		<include refid="listAudioFromWhere" />
		<include refid="CommonSQL.orderby" />
		<include refid="CommonSQL.pagingPostFix" />
    </select>

    <select id="listAudioForGroups" resultType="Map">
		SELECT 
			A.codec
			, FNC_CODENAME(A.channel_type) AS channel_type
			, A.sample_rate
			, A.sample_bit
			, A.is_input
		FROM
			audio A 
		WHERE 	1=1
			AND A.group_id = #{groupId}
		ORDER BY A.id ASC
    </select>

    <select id="listAudioForGroups4Mng" resultType="Map">
		SELECT 
			A.codec
			, A.channel_type
			, FNC_CODENAME(A.channel_type) AS channel_type_name
			, A.sample_rate
			, A.sample_bit
			, A.is_input
		FROM
			audio A 
		WHERE 	1=1
			AND A.group_id = #{groupId}
		ORDER BY A.id ASC
    </select>
    
    <insert id="insertAudio" parameterType="Map">
		INSERT INTO audio
		(
			id
			, group_id
			, codec
			, channel_type
			, sample_rate
			, sample_bit
			, is_input
		)
		VALUES
		(
			#{id}
			, #{groupId}
			, #{codec}
			, #{channelType}
			, #{sampleRate}
			, #{sampleBit}
			, #{isInput}
		)
		on DUPLICATE key update
			group_id = #{groupId}
			, codec = #{codec}
			, channel_type = #{channelType}
			, sample_rate = #{sampleRate}
			, sample_bit = #{sampleBit}
			, is_input = #{isInput}
	</insert>
</mapper>